# This is AUtogenerated content. Queries will probably not work and content may include inaccurate data or informations. Was created just for sake of example.

# **Detection Analytic Template**

### **1\. METADATA**

* **Analytic Title:** LSASS Memory Dump via ProcDump Utility  
* **ID:** DE-TA0006-T1003.001-003  
* **Version:** 1.1  
* **Status:** \[ \] Experimental \[x\] Test \[ \] Production  
* **Author:** SOC Team / John Doe  
* **Date Created:** 2025-06-25  
* **Date Modified:** 2025-06-25

### **2\. DETECTION OVERVIEW**

**Description:**

This analytic detects the use of the legitimate Microsoft Sysinternals tool, procdump.exe, to create a memory dump of the Local Security Authority Subsystem Service (LSASS) process. Adversaries abuse this utility to extract credential materials like password hashes and Kerberos tickets from memory for offline cracking and lateral movement.

**Hypothesis:**

We hypothesize that an adversary performing **OS Credential Dumping (T1003.001)** will leverage a pre-existing, trusted tool like procdump.exe to blend in with normal administrative activity. This behavior can be observed through process creation events where procdump.exe is executed with command-line arguments that specify lsass.exe as the target process.

**MITRE** ATT\&CK® **Mapping:**

* **Tactic(s):** Credential Access (TA0006)  
* **Technique(s):** OS Credential Dumping (T1003)  
* **Sub-technique(s):** LSASS Memory (T1003.001)

### **3\. ANALYTIC DETAILS (Summiting the Pyramid)**

**Analytic Robustness Level (Select One & Justify):**

*Justification:* This detection is focused on the execution of a specific, legitimate tool (procdump.exe). While an adversary cannot easily change how procdump.exe itself works, they can use a different tool or custom code to achieve the same goal, bypassing this specific detection. Therefore, it is *core to the use of a pre-existing tool, but not the technique itself.*

* \[ \] Level 1: Ephemeral  
* \[ \] Level 2: Core to Adversary-Brought Tool  
* \[x\] Level 3: Core to Pre-Existing Tool  
* \[ \] Level 4: Core to Some Implementations of a (Sub-)Technique  
* \[ \] Level 5: Core to a (Sub-)Technique (Invariant Behavior)

**Data Source & Event Robustness:**

* **Platform:** Windows  
* **Source:** EDR (e.g., Microsoft Defender for Endpoint), Sysmon  
* **Event(s):** DeviceProcessEvents (ActionType: ProcessCreated), Sysmon Event ID 1 (Process Create)  
* **Event Robustness Column (Select One):**  
  * **Host-Based:** \[ \] Application (A) \[ \] User-Mode (U) \[x\] Kernel-Mode (K)

  *Justification:* Process creation *events are generated by the OS Kernel, making them a highly reliable and difficult-to-tamper-with data source.*

  * **Network-Based:** \[ \] Protocol Payload (P) \[ \] Protocol Header (H)

**Final Summiting Score:** 3K

### **4\. LOGIC & IMPLEMENTATION**

**Detection Logic (Pseudocode or SIEM Query):**

\-- Using KQL for Microsoft Sentinel / Defender  
DeviceProcessEvents  
// This is the core of our detection: we are looking for a process being created.  
| where ActionType \== "ProcessCreated"  
// We are looking for the specific tool 'procdump.exe'. We check both the process name and the file name in the folder path.  
| where ProcessCommandLine has "procdump.exe" or InitiatingProcessFolderPath endswith "\\\\procdump.exe"  
// This is the behavioral indicator: the command line MUST target lsass.exe.  
// The '-ma' flag tells procdump to create a full memory dump.  
// We also look for the process ID of lsass being passed as an argument.  
| where ProcessCommandLine has "lsass" and ProcessCommandLine has\_any ("-ma", "-accepteula")

// \--- EXCLUSION STRATEGY \---  
// Filter out known administrative activity if possible. This is highly environment-specific.  
// A more advanced exclusion might involve checking if the initiating user is part of a specific  
// tier-0 admin group AND the activity originates from a secure admin workstation (PAW).  
| where InitiatingProcessAccountName \!in ("KNOWN\_ADMIN\_ACCOUNT\_FOR\_TROUBLESHOOTING")

**Known False Positives:**

* Legitimate system administrators or developers using procdump.exe for debugging, performance analysis, or crash analysis.  
* Automated troubleshooting scripts deployed by IT that may need to capture a process dump.

**Exclusion Strategy:**

The primary exclusion strategy should focus on context. While filtering by username is weak, it can be combined with other factors. A robust exclusion would involve maintaining a list of authorized users/hosts (e.g., Privileged Access Workstations) that are permitted to perform such actions. Activity outside of this established baseline should be investigated. Avoid simple exclusions on filenames, as attackers can rename tools.

### **5\. VALIDATION & RESPONSE (Funnel of Fidelity)**

**Testing Procedures:**

The goal is to confirm this rule detects the use of procdump, but also to understand its limitations by testing other credential dumping methods.

* **Test Case 1 (Functional Synonym):**  
  * **Tool/Procedure:** Execute procdump64.exe \-ma lsass.exe c:\\temp\\lsass.dmp.  
  * **Result:** \[x\] Detected \[ \] Not Detected  
* **Test** Case **2 (Procedural Synonym):**  
  * **Tool/Procedure:** Use a custom C\# tool that P/Invokes MiniDumpWriteDump directly to dump lsass.exe.  
  * **Result:** \[ \] Detected \[x\] Not Detected

*Note:* This test *proves our detection is at Level 3\. It correctly identifies the procdump tool but misses other implementations of the same procedure.*

* **Test** Case **3 (Sub-Technical Synonym):**  
  * **Tool/Procedure:** Use a tool that leverages the James Forshaw handle duplication method to access LSASS memory.  
  * **Result:** \[ \] Detected \[x\] Not Detected

*Note: This confirms the detection is not behavioral for the entire sub-technique, but is specific to the "dump via a separate utility" procedure.*

**Triage & Investigation Steps (Manual Playbook):**

This playbook helps a SOC analyst quickly assess an alert.

1. **Initial Triage (Is this a true positive?):**  
   * Identify the InitiatingProcessAccountName. Is this a system administrator or a standard user account? Standard user accounts should almost never perform this action.  
   * Identify the DeviceName. Is this a sensitive server (like a Domain Controller) or a standard user workstation?  
   * Check helpdesk/ticketing systems. Is there an active ticket for performance issues or application crashes on this host that would justify a memory dump?  
2. **Investigation (What is the context?):**  
   * Review the command line history on the device for the parent process (InitiatingProcessCommandLine). How was procdump.exe launched? Was it from an interactive CMD/PowerShell session or from another script?  
   * Examine the file system for the output dump file (e.g., lsass.dmp). Look for signs of staging for exfiltration (e.g., adding the dump to a password-protected zip file).  
   * Correlate the timestamp with other alerts on the host. Is this isolated, or is it part of a larger chain of activity (e.g., preceded by discovery commands, followed by network connections to an unusual IP)?

**Response & Remediation:**

* If confirmed malicious, immediately isolate the host from the network to prevent lateral movement.  
* Assume all credentials on the host have been compromised. Trigger a credential reset for all recently logged-on users.  
* Preserve the memory dump file (.dmp) and the malicious procdump.exe instance for forensic analysis.

### **6\. AUTOMATION & RESPONSE PLAYBOOK (SOAR)**

This section provides a structured playbook for automated systems to perform enrichment, containment, and notification actions.

**Alert Trigger Condition:**

* IF 'detection\_logic' RETURNS 'true'

**Alert Severity:**

* Default: High

**Enrichment Steps:**

* **Action:** Get-UserDetails  
  * **Input:** event.InitiatingProcessAccountName  
  * **Output:** user.title, user.department, user.manager, user.risk\_score  
* **Action:** Get-HostDetails  
  * **Input:** event.DeviceName  
  * **Output:** host.owner, host.os, host.tags (e.g., "Domain Controller", "PAW")  
* **Action:** Lookup-ProcessHash  
  * **Input:** event.InitiatingProcessSHA256  
  * **Source:** VirusTotal, Internal Threat Intel  
  * **Output:** hash.reputation, hash.detections  
* **Action:** Get-RecentLogonActivity  
  * **Input:** event.DeviceName  
  * **Timeframe:** Last 24 hours  
  * **Output:** host.recent\_users

**Triage Logic (Automated):**

* IF user.title contains 'Admin' AND host.tags contains 'PAW' \-\> SET 'Severity' to 'Low' AND 'await\_manual\_review'  
* IF hash.reputation \== 'malicious' \-\> SET 'Severity' to 'Critical' AND 'proceed\_to\_containment'  
* IF user.risk\_score \== 'High' \-\> SET 'Severity' to 'Critical' AND 'proceed\_to\_containment'

**Containment Steps (Requires 'Critical' Severity):**

* **Action:** Isolate-Host  
  * **Input:** event.DeviceName  
  * **Execute:** true (if automated containment is enabled for this rule)  
* **Action:** Disable-User  
  * **Input:** event.InitiatingProcessAccountName  
  * **Execute:** false (requires manual approval due to high impact)

**Notification Steps:**

* **Action:** Create-Ticket  
  * **System:** ServiceNow / Jira  
  * **Assignee:** SOC Tier 2  
  * **Content:** Include enriched alert data, severity, and recommended actions.  
* **Action:** Send-Email  
  * **Recipient:** soc-alerts@yourcompany.com  
  * **Subject:** CRITICAL Alert: LSASS Dump Detected on {{host.name}} by {{user.name}}  
  * **Content:** Summary of enriched alert.

### **7\. FRAMEWORK MAPPINGS**

**MITRE Engage™ Mapping:**

* **Goal:** Disrupt (G0009)  
* **Approach:** Detect (A0001)

**D3FEND Mapping:**

* **Tactic:** Detect (D3-DET)  
* **Technique:** Process Spawn Analysis (D3-PSA)
